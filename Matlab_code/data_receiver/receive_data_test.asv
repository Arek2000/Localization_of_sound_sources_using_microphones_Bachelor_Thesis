clear device;
global signal;
signal = [];
device = serialport("COM3",921600);
configureTerminator(device,"CR");
%s.BytesAvailableFcn = {@callbackFcn, signal};
configureCallback(device, "byte", 8000, @(src, evt) callbackFcn(src, evt));

%while true
%    disp(signal);
%end


function callbackFcn(src, ~)
    global signal;
    data = read(src, 8000, "uint16");
    if length(signal) > 44100
        signal = [[signal(8000:end)] data];
    else
        signal = [signal data];
    end
    L = 10
    fft_sig = fft(signal);
    P2 = abs(Y/L);
    P1 = P2(1:L/2+1);
    P1(2:end-1) = 2*P1(2:end-1);
    plot(fft_sig);
    %plot(signal);
    %toc;
    %tic;
end